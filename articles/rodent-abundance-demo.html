<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Portal Rodent Abundance Demo • portalr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Portal Rodent Abundance Demo">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">portalr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/portal_researcher_examples.html">Examples of How Portal Researchers Are Using the Package</a>
    </li>
    <li>
      <a href="../articles/rodent-abundance-demo.html">Portal Rodent Abundance Demo</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/weecology/portalr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Portal Rodent Abundance Demo</h1>
                        <h4 class="author">Hao Ye</h4>
            
            <h4 class="date">2019-10-03</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/weecology/portalr/blob/master/vignettes/rodent-abundance-demo.Rmd"><code>vignettes/rodent-abundance-demo.Rmd</code></a></small>
      <div class="hidden name"><code>rodent-abundance-demo.Rmd</code></div>

    </div>

    
    
<div id="introduction" class="section level1">
<h1 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h1>
<p>This vignette is a basic guide to begin exploring the Portal data. We load in the data (making sure that we’re using the most recent copy from GitHub), and then explore the rodent abundances over time, with a comparison between the “control” and “kangaroo rat exclosure” treatments.</p>
<div id="package-setup" class="section level2">
<h2 class="hasAnchor">
<a href="#package-setup" class="anchor"></a>Package Setup</h2>
<p>First we load several packages:</p>
<ul>
<li><p><code>tidyverse</code> contains several packages for data manipulation and plotting.</p></li>
<li><p><code>cowplot</code> contains a nicer default theme for ggplot.</p></li>
<li><p><code>portalr</code> is this package, which contains functions to read in the Portal data and do some basic processing.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cowplot)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(portalr)</a></code></pre></div>
</div>
</div>
<div id="retrieving-the-data" class="section level1">
<h1 class="hasAnchor">
<a href="#retrieving-the-data" class="anchor"></a>Retrieving the Data</h1>
<p>Note that this package does not contain the actual Portal data, which resides online in a <a href="https://github.com/weecology/PortalData">GitHub repository</a>.</p>
<p>First, we try to load the data. If there isn’t a Portal folder, than <code>load_rodent_data</code> will fall back to downloading the data, as well.</p>
<p>check whether we already have the data. If we don’t have the data, or if the version we have isn’t the most recent, we use the <code>download_observations</code> function to download the latest copy of the data.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">portal_data_path &lt;-<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span>() <span class="co"># use a temporary folder to store downloaded data</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">data_tables &lt;-<span class="st"> </span><span class="kw"><a href="../reference/load_rodent_data.html">load_rodent_data</a></span>(portal_data_path, <span class="dt">download_if_missing =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="co">#&gt; Warning in load_datafile(file.path("Rodents", "Portal_rodent.csv"), na.strings = "", : Proceeding to download data into specified path/tmp/Rtmpq3Hgx5</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="co">#&gt; Downloading version 1.135.1 of the data...</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="co">#&gt; Loading in data version 1.135.1</span></a></code></pre></div>
<p>The <code>load_rodent_data</code> function reads in several tables related to the rodent abundances. We won’t necessarily use all of these tables, but loading this now gives us access later.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(data_tables))</a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="co">#&gt;                Length Class      Mode</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co">#&gt; rodent_data    29     data.frame list</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="co">#&gt; species_table  15     data.frame list</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co">#&gt; trapping_table  8     data.frame list</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="co">#&gt; newmoons_table  4     data.frame list</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="co">#&gt; plots_table     6     data.frame list</span></a></code></pre></div>
</div>
<div id="rodent-abundances" class="section level1">
<h1 class="hasAnchor">
<a href="#rodent-abundances" class="anchor"></a>Rodent Abundances</h1>
<p>The first table that we loaded (<code>data_tables$rodent_data</code>) is a record of whatever was found in the traps, mostly rodents, but also a few other taxa. If we just wanted to get the rodent abundance data, we could use the <code>abundance</code> function, which has default arguments to filter out the non-rodents.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># get rodent abundance by plot</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">rodent_abundance_by_plot &lt;-<span class="st"> </span><span class="kw"><a href="../reference/summarize_rodent_data.html">abundance</a></span>(<span class="dt">path =</span> portal_data_path, <span class="dt">time =</span> <span class="st">"date"</span>, <span class="dt">level =</span> <span class="st">"plot"</span>) </a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="co">#&gt; Loading in data version 1.135.1</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">rodent_abundance &lt;-<span class="st"> </span>rodent_abundance_by_plot <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(species, abundance, <span class="op">-</span>censusdate, <span class="op">-</span>treatment, <span class="op">-</span>plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-7" data-line-number="7"><span class="st">  </span><span class="kw">count</span>(species, censusdate, <span class="dt">wt =</span> abundance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">abundance =</span> n)</a>
<a class="sourceLine" id="cb4-9" data-line-number="9"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(rodent_abundance))</a>
<a class="sourceLine" id="cb4-10" data-line-number="10"><span class="co">#&gt;    species            censusdate           abundance      </span></a>
<a class="sourceLine" id="cb4-11" data-line-number="11"><span class="co">#&gt;  Length:8799        Min.   :1979-09-22   Min.   :  0.000  </span></a>
<a class="sourceLine" id="cb4-12" data-line-number="12"><span class="co">#&gt;  Class :character   1st Qu.:1989-03-12   1st Qu.:  0.000  </span></a>
<a class="sourceLine" id="cb4-13" data-line-number="13"><span class="co">#&gt;  Mode  :character   Median :1997-11-22   Median :  0.000  </span></a>
<a class="sourceLine" id="cb4-14" data-line-number="14"><span class="co">#&gt;                     Mean   :1998-09-09   Mean   :  6.741  </span></a>
<a class="sourceLine" id="cb4-15" data-line-number="15"><span class="co">#&gt;                     3rd Qu.:2008-06-28   3rd Qu.:  5.000  </span></a>
<a class="sourceLine" id="cb4-16" data-line-number="16"><span class="co">#&gt;                     Max.   :2018-09-04   Max.   :285.000</span></a></code></pre></div>
<p>Let’s convert the data to long format for easier facetting. Also, we want the scientific names instead of the two-letter species codes, so let’s do that matching, too:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">join_scientific_name &lt;-<span class="st"> </span><span class="cf">function</span>(rodent_abundance, </a>
<a class="sourceLine" id="cb5-2" data-line-number="2">                                 <span class="dt">species_table =</span> data_tables<span class="op">$</span>species_table)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">{</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(rodent_abundance <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="st">           </span><span class="kw">left_join</span>(<span class="kw">select</span>(species_table, <span class="st">"species"</span>, <span class="st">"scientificname"</span>), </a>
<a class="sourceLine" id="cb5-6" data-line-number="6">                     <span class="dt">by =</span> <span class="st">"species"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">           </span><span class="kw">rename</span>(<span class="dt">scientific_name =</span> scientificname)</a>
<a class="sourceLine" id="cb5-8" data-line-number="8">  )</a>
<a class="sourceLine" id="cb5-9" data-line-number="9">}</a>
<a class="sourceLine" id="cb5-10" data-line-number="10"></a>
<a class="sourceLine" id="cb5-11" data-line-number="11">rodent_abundance &lt;-<span class="st"> </span><span class="kw">join_scientific_name</span>(rodent_abundance)</a></code></pre></div>
<div id="figure-abundance-over-time" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-abundance-over-time" class="anchor"></a>Figure: abundance over time</h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">make_abundance_plot_over_time &lt;-<span class="st"> </span><span class="cf">function</span>(rodent_abundance)</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">{</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="kw">ggplot</span>(rodent_abundance, </a>
<a class="sourceLine" id="cb6-4" data-line-number="4">                <span class="kw">aes</span>(<span class="dt">x =</span> censusdate, <span class="dt">y =</span> abundance)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">           </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">           </span><span class="kw">facet_wrap</span>(<span class="op">~</span>scientific_name, <span class="dt">scales =</span> <span class="st">"free_y"</span>, <span class="dt">ncol =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-7" data-line-number="7"><span class="st">           </span><span class="kw">xlab</span>(<span class="st">"Date"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-8" data-line-number="8"><span class="st">           </span><span class="kw">ylab</span>(<span class="st">"Abundance"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-9" data-line-number="9"><span class="st">           </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1977-01-01"</span>), <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2018-01-01"</span>), <span class="st">"+5 years"</span>), </a>
<a class="sourceLine" id="cb6-10" data-line-number="10">                        <span class="dt">date_labels =</span> <span class="st">"%Y"</span>, </a>
<a class="sourceLine" id="cb6-11" data-line-number="11">                        <span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1977-01-01"</span>, <span class="st">"2018-01-01"</span>))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="st">           </span><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-13" data-line-number="13"><span class="st">           </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>), </a>
<a class="sourceLine" id="cb6-14" data-line-number="14">                 <span class="dt">legend.position =</span> <span class="st">"bottom"</span>, <span class="dt">legend.justification =</span> <span class="st">"center"</span>, </a>
<a class="sourceLine" id="cb6-15" data-line-number="15">                 <span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb6-16" data-line-number="16">  )</a>
<a class="sourceLine" id="cb6-17" data-line-number="17">}</a>
<a class="sourceLine" id="cb6-18" data-line-number="18"></a>
<a class="sourceLine" id="cb6-19" data-line-number="19">my_plot &lt;-<span class="st"> </span><span class="kw">make_abundance_plot_over_time</span>(rodent_abundance)</a>
<a class="sourceLine" id="cb6-20" data-line-number="20"></a>
<a class="sourceLine" id="cb6-21" data-line-number="21"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(my_plot)</a>
<a class="sourceLine" id="cb6-22" data-line-number="22"><span class="co">#&gt; Warning: Removed 7 rows containing missing values (geom_path).</span></a></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-6-1.png" alt="Monthly abundance of rodents (all plots)" width="720"><p class="caption">
Monthly abundance of rodents (all plots)
</p>
</div>
</div>
<div id="next-steps" class="section level2">
<h2 class="hasAnchor">
<a href="#next-steps" class="anchor"></a>Next Steps</h2>
<p>Our next steps would likely be to dig deeper into the rodent abundances for different treatments, but first we want to know what the different treatments look like, so let’s revisit the abundances later.</p>
</div>
</div>
<div id="plot-treatments" class="section level1">
<h1 class="hasAnchor">
<a href="#plot-treatments" class="anchor"></a>Plot Treatments</h1>
<p>A description of the experimental design and treatments can be found in this <a href="https://github.com/weecology/PortalData/tree/master/SiteandMethods">Readme file</a> in the PortalDate repo.</p>
<p>For now, we are just going to use the <a href="https://github.com/weecology/PortalData/blob/master/SiteandMethods/Portal_plots.csv"><code>Portal_plots</code></a> table file to look at how the treatments for individual plots have changed over time. Note that this file is already loaded in as the <code>plots_table</code> from the <code>loadData</code> function we ran previously.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/summary.html">summary</a></span>(data_tables<span class="op">$</span>plots_table))</a>
<a class="sourceLine" id="cb7-2" data-line-number="2"><span class="co">#&gt;       year          month             plot        treatment        </span></a>
<a class="sourceLine" id="cb7-3" data-line-number="3"><span class="co">#&gt;  Min.   :1977   Min.   : 1.000   Min.   : 1.00   Length:10688      </span></a>
<a class="sourceLine" id="cb7-4" data-line-number="4"><span class="co">#&gt;  1st Qu.:1988   1st Qu.: 4.000   1st Qu.: 6.00   Class :character  </span></a>
<a class="sourceLine" id="cb7-5" data-line-number="5"><span class="co">#&gt;  Median :1998   Median : 7.000   Median :12.00   Mode  :character  </span></a>
<a class="sourceLine" id="cb7-6" data-line-number="6"><span class="co">#&gt;  Mean   :1998   Mean   : 6.522   Mean   :12.48                     </span></a>
<a class="sourceLine" id="cb7-7" data-line-number="7"><span class="co">#&gt;  3rd Qu.:2008   3rd Qu.: 9.000   3rd Qu.:18.00                     </span></a>
<a class="sourceLine" id="cb7-8" data-line-number="8"><span class="co">#&gt;  Max.   :2018   Max.   :12.000   Max.   :24.00                     </span></a>
<a class="sourceLine" id="cb7-9" data-line-number="9"><span class="co">#&gt;  resourcetreatment  anttreatment      </span></a>
<a class="sourceLine" id="cb7-10" data-line-number="10"><span class="co">#&gt;  Length:10688       Length:10688      </span></a>
<a class="sourceLine" id="cb7-11" data-line-number="11"><span class="co">#&gt;  Class :character   Class :character  </span></a>
<a class="sourceLine" id="cb7-12" data-line-number="12"><span class="co">#&gt;  Mode  :character   Mode  :character  </span></a>
<a class="sourceLine" id="cb7-13" data-line-number="13"><span class="co">#&gt;                                       </span></a>
<a class="sourceLine" id="cb7-14" data-line-number="14"><span class="co">#&gt;                                       </span></a>
<a class="sourceLine" id="cb7-15" data-line-number="15"><span class="co">#&gt; </span></a></code></pre></div>
<p>We want a proper date variable as well as converting <code>plot</code> into a factor:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">plot_treatments &lt;-<span class="st"> </span>data_tables<span class="op">$</span>plots_table <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">iso_date =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(year, <span class="st">"-"</span>, month, <span class="st">"-"</span>, <span class="st">"01"</span>)), </a>
<a class="sourceLine" id="cb8-3" data-line-number="3">         <span class="dt">plot =</span> <span class="kw"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span>(plot)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(iso_date, plot, treatment)</a></code></pre></div>
<div id="figure-plot-treatments-over-time" class="section level2">
<h2 class="hasAnchor">
<a href="#figure-plot-treatments-over-time" class="anchor"></a>Figure: plot treatments over time</h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">my_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(plot_treatments, </a>
<a class="sourceLine" id="cb9-2" data-line-number="2">                  <span class="kw">aes</span>(<span class="dt">x =</span> iso_date, <span class="dt">y =</span> treatment, <span class="dt">color =</span> treatment)) <span class="op">+</span></a>
<a class="sourceLine" id="cb9-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">20</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1977-10-01"</span>)), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1988-01-01"</span>)), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2005-01-01"</span>)), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_vline</span>(<span class="kw">aes</span>(<span class="dt">xintercept =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2015-04-01"</span>)), <span class="dt">linetype =</span> <span class="dv">2</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>plot, <span class="dt">ncol =</span> <span class="dv">4</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Date"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Treatment"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="dv">4</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-12" data-line-number="12"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1977-01-01"</span>), <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2018-01-01"</span>), <span class="st">"+5 years"</span>), <span class="dt">date_labels =</span> <span class="st">"%Y"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">  </span><span class="kw">guides</span>(<span class="dt">color =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>))</a>
<a class="sourceLine" id="cb9-16" data-line-number="16"></a>
<a class="sourceLine" id="cb9-17" data-line-number="17"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(my_plot)</a></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-9-1.png" alt="Treatments of Plots by Date" width="672"><p class="caption">
Treatments of Plots by Date
</p>
</div>
</div>
<div id="identifying-control-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#identifying-control-plots" class="anchor"></a>Identifying control plots</h2>
<p>The treatments for the plots have changed over time: in some cases, this was due to initial ramping up of the experimental protocol, in others, exclusions of <em>Dipodomys spectabilis</em> were started and then converted back later because the species went locally extinct (e.g. plots 1, 5, 9, 24).</p>
<div id="which-plots-have-always-been-control-plots" class="section level3">
<h3 class="hasAnchor">
<a href="#which-plots-have-always-been-control-plots" class="anchor"></a>Which plots have always been control plots?</h3>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">always_control_plots &lt;-<span class="st"> </span>plot_treatments <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(plot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">always_control =</span> <span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(treatment <span class="op">==</span><span class="st"> "control"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(always_control)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5"></a>
<a class="sourceLine" id="cb10-6" data-line-number="6"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(always_control_plots)</a>
<a class="sourceLine" id="cb10-7" data-line-number="7"><span class="co">#&gt; # A tibble: 4 x 2</span></a>
<a class="sourceLine" id="cb10-8" data-line-number="8"><span class="co">#&gt;   plot  always_control</span></a>
<a class="sourceLine" id="cb10-9" data-line-number="9"><span class="co">#&gt;   &lt;fct&gt; &lt;lgl&gt;         </span></a>
<a class="sourceLine" id="cb10-10" data-line-number="10"><span class="co">#&gt; 1 4     TRUE          </span></a>
<a class="sourceLine" id="cb10-11" data-line-number="11"><span class="co">#&gt; 2 11    TRUE          </span></a>
<a class="sourceLine" id="cb10-12" data-line-number="12"><span class="co">#&gt; 3 14    TRUE          </span></a>
<a class="sourceLine" id="cb10-13" data-line-number="13"><span class="co">#&gt; 4 17    TRUE</span></a></code></pre></div>
<p>Note, however, that this excludes several plots for which the treatment was changed ~2015. We can include these plots by first filtering by date before testing for the “control” treatment:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">mostly_control_plots &lt;-<span class="st"> </span>plot_treatments <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(iso_date <span class="op">&lt;</span><span class="st"> "2015-01-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb11-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mostly_control =</span> <span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(treatment <span class="op">==</span><span class="st"> "control"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(mostly_control)</a>
<a class="sourceLine" id="cb11-6" data-line-number="6"></a>
<a class="sourceLine" id="cb11-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(mostly_control_plots)</a>
<a class="sourceLine" id="cb11-8" data-line-number="8"><span class="co">#&gt; # A tibble: 8 x 2</span></a>
<a class="sourceLine" id="cb11-9" data-line-number="9"><span class="co">#&gt;   plot  mostly_control</span></a>
<a class="sourceLine" id="cb11-10" data-line-number="10"><span class="co">#&gt;   &lt;fct&gt; &lt;lgl&gt;         </span></a>
<a class="sourceLine" id="cb11-11" data-line-number="11"><span class="co">#&gt; 1 2     TRUE          </span></a>
<a class="sourceLine" id="cb11-12" data-line-number="12"><span class="co">#&gt; 2 4     TRUE          </span></a>
<a class="sourceLine" id="cb11-13" data-line-number="13"><span class="co">#&gt; 3 8     TRUE          </span></a>
<a class="sourceLine" id="cb11-14" data-line-number="14"><span class="co">#&gt; 4 11    TRUE          </span></a>
<a class="sourceLine" id="cb11-15" data-line-number="15"><span class="co">#&gt; 5 12    TRUE          </span></a>
<a class="sourceLine" id="cb11-16" data-line-number="16"><span class="co">#&gt; 6 14    TRUE          </span></a>
<a class="sourceLine" id="cb11-17" data-line-number="17"><span class="co">#&gt; 7 17    TRUE          </span></a>
<a class="sourceLine" id="cb11-18" data-line-number="18"><span class="co">#&gt; 8 22    TRUE</span></a></code></pre></div>
<p>And to identify the datespan over which these plots have been controls:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">date_span &lt;-<span class="st"> </span>plot_treatments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(plot <span class="op">%in%</span><span class="st"> </span>mostly_control_plots<span class="op">$</span>plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(iso_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">all_control =</span> <span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(treatment <span class="op">==</span><span class="st"> "control"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb12-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(all_control)</a>
<a class="sourceLine" id="cb12-6" data-line-number="6"></a>
<a class="sourceLine" id="cb12-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(date_span)</a>
<a class="sourceLine" id="cb12-8" data-line-number="8"><span class="co">#&gt; # A tibble: 411 x 2</span></a>
<a class="sourceLine" id="cb12-9" data-line-number="9"><span class="co">#&gt;    iso_date   all_control</span></a>
<a class="sourceLine" id="cb12-10" data-line-number="10"><span class="co">#&gt;    &lt;date&gt;     &lt;lgl&gt;      </span></a>
<a class="sourceLine" id="cb12-11" data-line-number="11"><span class="co">#&gt;  1 1977-07-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-12" data-line-number="12"><span class="co">#&gt;  2 1977-08-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-13" data-line-number="13"><span class="co">#&gt;  3 1977-09-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-14" data-line-number="14"><span class="co">#&gt;  4 1977-10-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-15" data-line-number="15"><span class="co">#&gt;  5 1977-11-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-16" data-line-number="16"><span class="co">#&gt;  6 1977-12-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-17" data-line-number="17"><span class="co">#&gt;  7 1978-01-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-18" data-line-number="18"><span class="co">#&gt;  8 1978-02-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-19" data-line-number="19"><span class="co">#&gt;  9 1978-03-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-20" data-line-number="20"><span class="co">#&gt; 10 1978-04-01 TRUE       </span></a>
<a class="sourceLine" id="cb12-21" data-line-number="21"><span class="co">#&gt; # … with 401 more rows</span></a></code></pre></div>
</div>
</div>
<div id="abundances-over-control-plots" class="section level2">
<h2 class="hasAnchor">
<a href="#abundances-over-control-plots" class="anchor"></a>Abundances over control plots</h2>
<p>We are now ready to plot abundances just over the control plots and the time span in 1977-07-01 to 2015-03-01. We do this by retrieving the abundance data by plot, and then filtering accordingly:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">rodent_abundance_by_plot <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(censusdate <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(date_span<span class="op">$</span>iso_date), </a>
<a class="sourceLine" id="cb13-3" data-line-number="3">         censusdate <span class="op">&lt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(date_span<span class="op">$</span>iso_date), </a>
<a class="sourceLine" id="cb13-4" data-line-number="4">         plot <span class="op">%in%</span><span class="st"> </span>mostly_control_plots<span class="op">$</span>plot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>treatment, <span class="op">-</span>plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(species, abundance, <span class="op">-</span>censusdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="st">  </span><span class="kw">count</span>(censusdate, species, <span class="dt">wt =</span> abundance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">abundance =</span> n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-9" data-line-number="9"><span class="st">  </span><span class="kw">join_scientific_name</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb13-10" data-line-number="10"><span class="st">  </span>{.} -&gt;<span class="st"> </span>rodent_abundance_control</a>
<a class="sourceLine" id="cb13-11" data-line-number="11"></a>
<a class="sourceLine" id="cb13-12" data-line-number="12">rodent_abundance_control <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-13" data-line-number="13"><span class="st">  </span><span class="kw">make_abundance_plot_over_time</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb13-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>()</a></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-13-1.png" alt="Monthly abundance of rodents (control plots)" width="720"><p class="caption">
Monthly abundance of rodents (control plots)
</p>
</div>
</div>
<div id="abundances-over-rodent-exclosures" class="section level2">
<h2 class="hasAnchor">
<a href="#abundances-over-rodent-exclosures" class="anchor"></a>Abundances over rodent exclosures</h2>
<p>We can do the same with the “exclosure” condition. First, which plots:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">mostly_exclosure_plots &lt;-<span class="st"> </span>plot_treatments <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(iso_date <span class="op">&gt;</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1989-01-01"</span>), </a>
<a class="sourceLine" id="cb14-3" data-line-number="3">         iso_date <span class="op">&lt;</span><span class="st"> "2015-01-01"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-4" data-line-number="4"><span class="st">  </span><span class="kw">group_by</span>(plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb14-5" data-line-number="5"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">mostly_exclosure =</span> <span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(treatment <span class="op">==</span><span class="st"> "exclosure"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb14-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(mostly_exclosure)</a>
<a class="sourceLine" id="cb14-7" data-line-number="7"></a>
<a class="sourceLine" id="cb14-8" data-line-number="8"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(mostly_exclosure_plots)</a>
<a class="sourceLine" id="cb14-9" data-line-number="9"><span class="co">#&gt; # A tibble: 8 x 2</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10"><span class="co">#&gt;   plot  mostly_exclosure</span></a>
<a class="sourceLine" id="cb14-11" data-line-number="11"><span class="co">#&gt;   &lt;fct&gt; &lt;lgl&gt;           </span></a>
<a class="sourceLine" id="cb14-12" data-line-number="12"><span class="co">#&gt; 1 3     TRUE            </span></a>
<a class="sourceLine" id="cb14-13" data-line-number="13"><span class="co">#&gt; 2 6     TRUE            </span></a>
<a class="sourceLine" id="cb14-14" data-line-number="14"><span class="co">#&gt; 3 13    TRUE            </span></a>
<a class="sourceLine" id="cb14-15" data-line-number="15"><span class="co">#&gt; 4 15    TRUE            </span></a>
<a class="sourceLine" id="cb14-16" data-line-number="16"><span class="co">#&gt; 5 18    TRUE            </span></a>
<a class="sourceLine" id="cb14-17" data-line-number="17"><span class="co">#&gt; 6 19    TRUE            </span></a>
<a class="sourceLine" id="cb14-18" data-line-number="18"><span class="co">#&gt; 7 20    TRUE            </span></a>
<a class="sourceLine" id="cb14-19" data-line-number="19"><span class="co">#&gt; 8 21    TRUE</span></a></code></pre></div>
<p>Then, the datespan:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">date_span &lt;-<span class="st"> </span>plot_treatments <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(plot <span class="op">%in%</span><span class="st"> </span>mostly_exclosure_plots<span class="op">$</span>plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(iso_date) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-4" data-line-number="4"><span class="st">  </span><span class="kw">summarize</span>(<span class="dt">all_exclosure =</span> <span class="kw"><a href="https://rdrr.io/r/base/all.html">all</a></span>(treatment <span class="op">==</span><span class="st"> "exclosure"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(all_exclosure)</a>
<a class="sourceLine" id="cb15-6" data-line-number="6"></a>
<a class="sourceLine" id="cb15-7" data-line-number="7"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(date_span)</a>
<a class="sourceLine" id="cb15-8" data-line-number="8"><span class="co">#&gt; # A tibble: 297 x 2</span></a>
<a class="sourceLine" id="cb15-9" data-line-number="9"><span class="co">#&gt;    iso_date   all_exclosure</span></a>
<a class="sourceLine" id="cb15-10" data-line-number="10"><span class="co">#&gt;    &lt;date&gt;     &lt;lgl&gt;        </span></a>
<a class="sourceLine" id="cb15-11" data-line-number="11"><span class="co">#&gt;  1 1988-01-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-12" data-line-number="12"><span class="co">#&gt;  2 1988-02-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-13" data-line-number="13"><span class="co">#&gt;  3 1988-03-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14"><span class="co">#&gt;  4 1988-04-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-15" data-line-number="15"><span class="co">#&gt;  5 1988-05-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-16" data-line-number="16"><span class="co">#&gt;  6 1988-06-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-17" data-line-number="17"><span class="co">#&gt;  7 1988-07-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-18" data-line-number="18"><span class="co">#&gt;  8 1988-08-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-19" data-line-number="19"><span class="co">#&gt;  9 1988-09-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-20" data-line-number="20"><span class="co">#&gt; 10 1988-10-01 TRUE         </span></a>
<a class="sourceLine" id="cb15-21" data-line-number="21"><span class="co">#&gt; # … with 287 more rows</span></a></code></pre></div>
<p>Finally, the figure:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">rodent_abundance_by_plot <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span>(censusdate <span class="op">&gt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(date_span<span class="op">$</span>iso_date), </a>
<a class="sourceLine" id="cb16-3" data-line-number="3">         censusdate <span class="op">&lt;=</span><span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(date_span<span class="op">$</span>iso_date), </a>
<a class="sourceLine" id="cb16-4" data-line-number="4">         plot <span class="op">%in%</span><span class="st"> </span>mostly_exclosure_plots<span class="op">$</span>plot) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>treatment, <span class="op">-</span>plot) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(species, abundance, <span class="op">-</span>censusdate) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-7" data-line-number="7"><span class="st">  </span><span class="kw">count</span>(censusdate, species, <span class="dt">wt =</span> abundance) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-8" data-line-number="8"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">abundance =</span> n) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-9" data-line-number="9"><span class="st">  </span><span class="kw">join_scientific_name</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb16-10" data-line-number="10"><span class="st">  </span>{.} -&gt;<span class="st"> </span>rodent_abundance_exclosure</a>
<a class="sourceLine" id="cb16-11" data-line-number="11"></a>
<a class="sourceLine" id="cb16-12" data-line-number="12">rodent_abundance_exclosure <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-13" data-line-number="13"><span class="st">  </span><span class="kw">make_abundance_plot_over_time</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb16-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>()</a></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-16-1.png" alt="Monthly abundance of rodents (exclosure plots)" width="720"><p class="caption">
Monthly abundance of rodents (exclosure plots)
</p>
</div>
<p>Since these data have the same number of plots as the previous figure, we can directly compare abundances. Note the decreased numbers for kangaroo rats (<em>Dipodomys spp.</em>) and increased numbers for some other taxa.</p>
</div>
<div id="comparison-figure" class="section level2">
<h2 class="hasAnchor">
<a href="#comparison-figure" class="anchor"></a>Comparison Figure</h2>
<p>Let’s merge the two datasets and produce a combined plot:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">rodent_abundance_merged &lt;-<span class="st"> </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb17-2" data-line-number="2">  <span class="kw">mutate</span>(rodent_abundance_control, <span class="dt">treatment =</span> <span class="st">"control"</span>), </a>
<a class="sourceLine" id="cb17-3" data-line-number="3">  <span class="kw">mutate</span>(rodent_abundance_exclosure, <span class="dt">treatment =</span> <span class="st">"exclosure"</span>))</a>
<a class="sourceLine" id="cb17-4" data-line-number="4"></a>
<a class="sourceLine" id="cb17-5" data-line-number="5">merged_plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(rodent_abundance_merged, </a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                      <span class="kw">aes</span>(<span class="dt">x =</span> censusdate, <span class="dt">y =</span> abundance, <span class="dt">color =</span> treatment)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_line</span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-8" data-line-number="8"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>scientific_name, <span class="dt">scales =</span> <span class="st">"free_y"</span>, <span class="dt">ncol =</span> <span class="dv">3</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9"><span class="st">  </span><span class="kw">xlab</span>(<span class="st">"Date"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-10" data-line-number="10"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"Abundance"</span>) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-11" data-line-number="11"><span class="st">  </span><span class="kw">scale_x_date</span>(<span class="dt">breaks =</span> <span class="kw"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"1977-01-01"</span>), <span class="dt">to =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="st">"2018-01-01"</span>), <span class="st">"+5 years"</span>), </a>
<a class="sourceLine" id="cb17-12" data-line-number="12">               <span class="dt">date_labels =</span> <span class="st">"%Y"</span>, </a>
<a class="sourceLine" id="cb17-13" data-line-number="13">               <span class="dt">limits =</span> <span class="kw"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"1977-01-01"</span>, <span class="st">"2018-01-01"</span>))) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14"><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"purple"</span>, <span class="st">"yellow"</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-15" data-line-number="15"><span class="st">  </span><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/theme_cowplot.html">theme_cowplot</a></span>() <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb17-16" data-line-number="16"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">axis.text.x =</span> <span class="kw">element_text</span>(<span class="dt">angle =</span> <span class="dv">90</span>, <span class="dt">hjust =</span> <span class="dv">1</span>, <span class="dt">vjust =</span> <span class="fl">0.5</span>), </a>
<a class="sourceLine" id="cb17-17" data-line-number="17">        <span class="dt">legend.position =</span> <span class="st">"bottom"</span>, <span class="dt">legend.justification =</span> <span class="st">"center"</span>, </a>
<a class="sourceLine" id="cb17-18" data-line-number="18">        <span class="dt">strip.text.x =</span> <span class="kw">element_text</span>(<span class="dt">size =</span> <span class="dv">10</span>))</a>
<a class="sourceLine" id="cb17-19" data-line-number="19"></a>
<a class="sourceLine" id="cb17-20" data-line-number="20"><span class="kw"><a href="https://rdrr.io/r/base/print.html">print</a></span>(merged_plot)</a></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-17-1.png" alt="Monthly abundance of rodents (control vs. exclosure plots)" width="720"><p class="caption">
Monthly abundance of rodents (control vs. exclosure plots)
</p>
</div>
<p>As expected, there are substantially lower counts of kangaroo rats (<em>Dipodomys spp.</em>) in the “exclosure” plots. We also observe very similar abundances for some species, but increases in others (e.g. “Chaetodipus baileyi”, “Perognathus flavus”, “Reithrodontomys megalotis”)</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li>
<a href="#introduction">Introduction</a><ul class="nav nav-pills nav-stacked">
<li><a href="#package-setup">Package Setup</a></li>
      </ul>
</li>
      <li><a href="#retrieving-the-data">Retrieving the Data</a></li>
      <li>
<a href="#rodent-abundances">Rodent Abundances</a><ul class="nav nav-pills nav-stacked">
<li><a href="#figure-abundance-over-time">Figure: abundance over time</a></li>
      <li><a href="#next-steps">Next Steps</a></li>
      </ul>
</li>
      <li>
<a href="#plot-treatments">Plot Treatments</a><ul class="nav nav-pills nav-stacked">
<li><a href="#figure-plot-treatments-over-time">Figure: plot treatments over time</a></li>
      <li><a href="#identifying-control-plots">Identifying control plots</a></li>
      <li><a href="#abundances-over-control-plots">Abundances over control plots</a></li>
      <li><a href="#abundances-over-rodent-exclosures">Abundances over rodent exclosures</a></li>
      <li><a href="#comparison-figure">Comparison Figure</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Glenda M. Yenni, Hao Ye, Erica M. Christensen, Juniper L. Simonis, Ellen K. Bledsoe, Renata M. Diaz, Shawn D. Taylor, Ethan P, White, S.K. Morgan Ernest.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
