<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Portal Rodent Abundance Demo • portalr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Portal Rodent Abundance Demo">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">portalr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.4.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/portal_researcher_examples.html">Examples of How Portal Researchers Are Using the Package</a></li>
    <li><a class="dropdown-item" href="../articles/rodent-abundance-demo.html">Portal Rodent Abundance Demo</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/weecology/portalr/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Portal Rodent Abundance Demo</h1>
                        <h4 data-toc-skip class="author">Hao Ye</h4>
            
            <h4 data-toc-skip class="date">2024-08-28</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/weecology/portalr/blob/v0.4.2/vignettes/rodent-abundance-demo.Rmd" class="external-link"><code>vignettes/rodent-abundance-demo.Rmd</code></a></small>
      <div class="d-none name"><code>rodent-abundance-demo.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette is a basic guide to begin exploring the Portal data. We
load in the data (making sure that we’re using the most recent copy from
GitHub), and then explore the rodent abundances over time, with a
comparison between the “control” and “kangaroo rat exclosure”
treatments.</p>
<div class="section level3">
<h3 id="package-setup">Package Setup<a class="anchor" aria-label="anchor" href="#package-setup"></a>
</h3>
<p>First we load several packages:</p>
<ul>
<li><p><code>tidyverse</code> contains several packages for data
manipulation and plotting.</p></li>
<li><p><code>cowplot</code> contains a nicer default theme for
ggplot.</p></li>
<li><p><code>portalr</code> is this package, which contains functions to
read in the Portal data and do some basic processing.</p></li>
</ul>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://weecology.github.io/portalr/">portalr</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="retrieving-the-data">Retrieving the Data<a class="anchor" aria-label="anchor" href="#retrieving-the-data"></a>
</h2>
<p>Note that this package does not contain the actual Portal data, which
resides online in a <a href="https://github.com/weecology/PortalData" class="external-link">GitHub
repository</a>.</p>
<p>First, we try to load the data. If there isn’t a Portal folder, than
<code>load_rodent_data</code> will fall back to downloading the data, as
well.</p>
<p>check whether we already have the data. If we don’t have the data, or
if the version we have isn’t the most recent, we use the
<code>download_observations</code> function to download the latest copy
of the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">portal_data_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># use a temporary folder to store downloaded data</span></span>
<span><span class="va">data_tables</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/load_rodent_data.html">load_rodent_data</a></span><span class="op">(</span><span class="va">portal_data_path</span>, download_if_missing <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in load_datafile(file.path("Rodents", "Portal_rodent.csv"), na.strings = "", : Proceeding to download data into specified path/tmp/RtmpOXpEsS</span></span>
<span><span class="co">#&gt; Downloading version `5.96.0` of the data...</span></span>
<span><span class="co">#&gt; Loading in data version 5.96.0</span></span></code></pre></div>
<p>The <code>load_rodent_data</code> function reads in several tables
related to the rodent abundances. We won’t necessarily use all of these
tables, but loading this now gives us access later.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data_tables</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;                Length Class      Mode</span></span>
<span><span class="co">#&gt; rodent_data    31     data.frame list</span></span>
<span><span class="co">#&gt; species_table  15     data.frame list</span></span>
<span><span class="co">#&gt; trapping_table  8     data.frame list</span></span>
<span><span class="co">#&gt; newmoons_table  4     data.frame list</span></span>
<span><span class="co">#&gt; plots_table     6     data.frame list</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="rodent-abundances">Rodent Abundances<a class="anchor" aria-label="anchor" href="#rodent-abundances"></a>
</h2>
<p>The first table that we loaded (<code>data_tables$rodent_data</code>)
is a record of whatever was found in the traps, mostly rodents, but also
a few other taxa. If we just wanted to get the rodent abundance data, we
could use the <code>abundance</code> function, which has default
arguments to filter out the non-rodents.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get rodent abundance by plot</span></span>
<span><span class="va">rodent_abundance_by_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/summarize_rodent_data.html">abundance</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">portal_data_path</span>, time <span class="op">=</span> <span class="st">"date"</span>, level <span class="op">=</span> <span class="st">"plot"</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Loading in data version 5.96.0</span></span>
<span></span>
<span><span class="va">rodent_abundance</span> <span class="op">&lt;-</span> <span class="va">rodent_abundance_by_plot</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">abundance</span>, <span class="op">-</span><span class="va">censusdate</span>, <span class="op">-</span><span class="va">treatment</span>, <span class="op">-</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">censusdate</span>, wt <span class="op">=</span> <span class="va">abundance</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">n</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">rodent_abundance</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;    species            censusdate           abundance      </span></span>
<span><span class="co">#&gt;  Length:9513        Min.   :1979-09-22   Min.   :  0.000  </span></span>
<span><span class="co">#&gt;  Class :character   1st Qu.:1989-12-04   1st Qu.:  0.000  </span></span>
<span><span class="co">#&gt;  Mode  :character   Median :1999-06-12   Median :  0.000  </span></span>
<span><span class="co">#&gt;                     Mean   :2000-05-21   Mean   :  6.897  </span></span>
<span><span class="co">#&gt;                     3rd Qu.:2010-09-05   3rd Qu.:  5.000  </span></span>
<span><span class="co">#&gt;                     Max.   :2023-06-20   Max.   :334.000</span></span></code></pre></div>
<p>Let’s convert the data to long format for easier facetting. Also, we
want the scientific names instead of the two-letter species codes, so
let’s do that matching, too:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">join_scientific_name</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rodent_abundance</span>, </span>
<span>                                 <span class="va">species_table</span> <span class="op">=</span> <span class="va">data_tables</span><span class="op">$</span><span class="va">species_table</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">rodent_abundance</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species_table</span>, <span class="st">"species"</span>, <span class="st">"scientificname"</span><span class="op">)</span>, </span>
<span>                     by <span class="op">=</span> <span class="st">"species"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>scientific_name <span class="op">=</span> <span class="va">scientificname</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">rodent_abundance</span> <span class="op">&lt;-</span> <span class="fu">join_scientific_name</span><span class="op">(</span><span class="va">rodent_abundance</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="figure-abundance-over-time">Figure: abundance over time<a class="anchor" aria-label="anchor" href="#figure-abundance-over-time"></a>
</h3>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">make_abundance_plot_over_time</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">rodent_abundance</span><span class="op">)</span></span>
<span><span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rodent_abundance</span>, </span>
<span>                <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">censusdate</span>, y <span class="op">=</span> <span class="va">abundance</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">scientific_name</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Abundance"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1977-01-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, <span class="st">"+5 years"</span><span class="op">)</span>, </span>
<span>                        date_labels <span class="op">=</span> <span class="st">"%Y"</span>, </span>
<span>                        limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1977-01-01"</span>, <span class="st">"2018-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>           <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>                 legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.justification <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>                 strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu">make_abundance_plot_over_time</span><span class="op">(</span><span class="va">rodent_abundance</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">my_plot</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 41 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">#&gt; (`geom_line()`).</span></span></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-6-1.png" alt="Monthly abundance of rodents (all plots)" width="720"><p class="caption">
Monthly abundance of rodents (all plots)
</p>
</div>
</div>
<div class="section level3">
<h3 id="next-steps">Next Steps<a class="anchor" aria-label="anchor" href="#next-steps"></a>
</h3>
<p>Our next steps would likely be to dig deeper into the rodent
abundances for different treatments, but first we want to know what the
different treatments look like, so let’s revisit the abundances
later.</p>
</div>
</div>
<div class="section level2">
<h2 id="plot-treatments">Plot Treatments<a class="anchor" aria-label="anchor" href="#plot-treatments"></a>
</h2>
<p>A description of the experimental design and treatments can be found
in this <a href="https://github.com/weecology/PortalData/tree/main/SiteandMethods" class="external-link">Readme
file</a> in the PortalDate repo.</p>
<p>For now, we are just going to use the <a href="https://github.com/weecology/PortalData/blob/main/SiteandMethods/Portal_plots.csv" class="external-link"><code>Portal_plots</code></a>
table file to look at how the treatments for individual plots have
changed over time. Note that this file is already loaded in as the
<code>plots_table</code> from the <code>loadData</code> function we ran
previously.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data_tables</span><span class="op">$</span><span class="va">plots_table</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;       year          month             plot        treatment        </span></span>
<span><span class="co">#&gt;  Min.   :1977   Min.   : 1.000   Min.   : 1.00   Length:11576      </span></span>
<span><span class="co">#&gt;  1st Qu.:1988   1st Qu.: 4.000   1st Qu.: 6.00   Class :character  </span></span>
<span><span class="co">#&gt;  Median :1999   Median : 7.000   Median :12.00   Mode  :character  </span></span>
<span><span class="co">#&gt;  Mean   :1999   Mean   : 6.536   Mean   :12.49                     </span></span>
<span><span class="co">#&gt;  3rd Qu.:2010   3rd Qu.:10.000   3rd Qu.:18.00                     </span></span>
<span><span class="co">#&gt;  Max.   :2023   Max.   :12.000   Max.   :24.00                     </span></span>
<span><span class="co">#&gt;  resourcetreatment  anttreatment      </span></span>
<span><span class="co">#&gt;  Length:11576       Length:11576      </span></span>
<span><span class="co">#&gt;  Class :character   Class :character  </span></span>
<span><span class="co">#&gt;  Mode  :character   Mode  :character  </span></span>
<span><span class="co">#&gt;                                       </span></span>
<span><span class="co">#&gt;                                       </span></span>
<span><span class="co">#&gt; </span></span></code></pre></div>
<p>We want a proper date variable as well as converting
<code>plot</code> into a factor:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot_treatments</span> <span class="op">&lt;-</span> <span class="va">data_tables</span><span class="op">$</span><span class="va">plots_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>iso_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">year</span>, <span class="st">"-"</span>, <span class="va">month</span>, <span class="st">"-"</span>, <span class="st">"01"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>         plot <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">iso_date</span>, <span class="va">plot</span>, <span class="va">treatment</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="figure-plot-treatments-over-time">Figure: plot treatments over time<a class="anchor" aria-label="anchor" href="#figure-plot-treatments-over-time"></a>
</h3>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">my_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">plot_treatments</span>, </span>
<span>                  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">iso_date</span>, y <span class="op">=</span> <span class="va">treatment</span>, color <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1977-10-01"</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1988-01-01"</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2005-01-01"</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2015-04-01"</span><span class="op">)</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">plot</span>, ncol <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Treatment"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1977-01-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, <span class="st">"+5 years"</span><span class="op">)</span>, date_labels <span class="op">=</span> <span class="st">"%Y"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">my_plot</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-9-1.png" alt="Treatments of Plots by Date" width="672"><p class="caption">
Treatments of Plots by Date
</p>
</div>
</div>
<div class="section level3">
<h3 id="identifying-control-plots">Identifying control plots<a class="anchor" aria-label="anchor" href="#identifying-control-plots"></a>
</h3>
<p>The treatments for the plots have changed over time: in some cases,
this was due to initial ramping up of the experimental protocol, in
others, exclusions of <em>Dipodomys spectabilis</em> were started and
then converted back later because the species went locally extinct
(e.g. plots 1, 5, 9, 24).</p>
<div class="section level4">
<h4 id="which-plots-have-always-been-control-plots">Which plots have always been control plots?<a class="anchor" aria-label="anchor" href="#which-plots-have-always-been-control-plots"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">always_control_plots</span> <span class="op">&lt;-</span> <span class="va">plot_treatments</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>always_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"control"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">always_control</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">always_control_plots</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 2</span></span></span>
<span><span class="co">#&gt;   plot  always_control</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 4     TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 11    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 14    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 17    TRUE</span></span></code></pre></div>
<p>Note, however, that this excludes several plots for which the
treatment was changed ~2015. We can include these plots by first
filtering by date before testing for the “control” treatment:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mostly_control_plots</span> <span class="op">&lt;-</span> <span class="va">plot_treatments</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso_date</span> <span class="op">&lt;</span> <span class="st">"2015-01-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mostly_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"control"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mostly_control</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mostly_control_plots</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   plot  mostly_control</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 2     TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 4     TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 8     TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 11    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 12    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 14    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 17    TRUE          </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 22    TRUE</span></span></code></pre></div>
<p>And to identify the datespan over which these plots have been
controls:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date_span</span> <span class="op">&lt;-</span> <span class="va">plot_treatments</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mostly_control_plots</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iso_date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>all_control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"control"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">all_control</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 411 × 2</span></span></span>
<span><span class="co">#&gt;    iso_date   all_control</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1977-07-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1977-08-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1977-09-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1977-10-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1977-11-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1977-12-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1978-01-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1978-02-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1978-03-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1978-04-01 TRUE       </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 401 more rows</span></span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="abundances-over-control-plots">Abundances over control plots<a class="anchor" aria-label="anchor" href="#abundances-over-control-plots"></a>
</h3>
<p>We are now ready to plot abundances just over the control plots and
the time span in 1977-07-01 to 2015-03-01. We do this by retrieving the
abundance data by plot, and then filtering accordingly:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rodent_abundance_by_plot</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">censusdate</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">$</span><span class="va">iso_date</span><span class="op">)</span>, </span>
<span>         <span class="va">censusdate</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">$</span><span class="va">iso_date</span><span class="op">)</span>, </span>
<span>         <span class="va">plot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mostly_control_plots</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">treatment</span>, <span class="op">-</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">abundance</span>, <span class="op">-</span><span class="va">censusdate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">censusdate</span>, <span class="va">species</span>, wt <span class="op">=</span> <span class="va">abundance</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">join_scientific_name</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="va">.</span><span class="op">}</span> <span class="op">-&gt;</span> <span class="va">rodent_abundance_control</span></span>
<span></span>
<span><span class="va">rodent_abundance_control</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">make_abundance_plot_over_time</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-13-1.png" alt="Monthly abundance of rodents (control plots)" width="720"><p class="caption">
Monthly abundance of rodents (control plots)
</p>
</div>
</div>
<div class="section level3">
<h3 id="abundances-over-rodent-exclosures">Abundances over rodent exclosures<a class="anchor" aria-label="anchor" href="#abundances-over-rodent-exclosures"></a>
</h3>
<p>We can do the same with the “exclosure” condition. First, which
plots:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mostly_exclosure_plots</span> <span class="op">&lt;-</span> <span class="va">plot_treatments</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">iso_date</span> <span class="op">&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1989-01-01"</span><span class="op">)</span>, </span>
<span>         <span class="va">iso_date</span> <span class="op">&lt;</span> <span class="st">"2015-01-01"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mostly_exclosure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"exclosure"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">mostly_exclosure</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">mostly_exclosure_plots</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 2</span></span></span>
<span><span class="co">#&gt;   plot  mostly_exclosure</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 3     TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 6     TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 13    TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 15    TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 18    TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 19    TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> 20    TRUE            </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> 21    TRUE</span></span></code></pre></div>
<p>Then, the datespan:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">date_span</span> <span class="op">&lt;-</span> <span class="va">plot_treatments</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">plot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mostly_exclosure_plots</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">iso_date</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>all_exclosure <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="va">treatment</span> <span class="op">==</span> <span class="st">"exclosure"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">all_exclosure</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 297 × 2</span></span></span>
<span><span class="co">#&gt;    iso_date   all_exclosure</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>     <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>        </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1988-01-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1988-02-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1988-03-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1988-04-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1988-05-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1988-06-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1988-07-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1988-08-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1988-09-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1988-10-01 TRUE         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 287 more rows</span></span></span></code></pre></div>
<p>Finally, the figure:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rodent_abundance_by_plot</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">censusdate</span> <span class="op">&gt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">$</span><span class="va">iso_date</span><span class="op">)</span>, </span>
<span>         <span class="va">censusdate</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">date_span</span><span class="op">$</span><span class="va">iso_date</span><span class="op">)</span>, </span>
<span>         <span class="va">plot</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="va">mostly_exclosure_plots</span><span class="op">$</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">treatment</span>, <span class="op">-</span><span class="va">plot</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">abundance</span>, <span class="op">-</span><span class="va">censusdate</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">censusdate</span>, <span class="va">species</span>, wt <span class="op">=</span> <span class="va">abundance</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>abundance <span class="op">=</span> <span class="va">n</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">join_scientific_name</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="op">{</span><span class="va">.</span><span class="op">}</span> <span class="op">-&gt;</span> <span class="va">rodent_abundance_exclosure</span></span>
<span></span>
<span><span class="va">rodent_abundance_exclosure</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">make_abundance_plot_over_time</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-16-1.png" alt="Monthly abundance of rodents (exclosure plots)" width="720"><p class="caption">
Monthly abundance of rodents (exclosure plots)
</p>
</div>
<p>Since these data have the same number of plots as the previous
figure, we can directly compare abundances. Note the decreased numbers
for kangaroo rats (<em>Dipodomys spp.</em>) and increased numbers for
some other taxa.</p>
</div>
<div class="section level3">
<h3 id="comparison-figure">Comparison Figure<a class="anchor" aria-label="anchor" href="#comparison-figure"></a>
</h3>
<p>Let’s merge the two datasets and produce a combined plot:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rodent_abundance_merged</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">rodent_abundance_control</span>, treatment <span class="op">=</span> <span class="st">"control"</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">rodent_abundance_exclosure</span>, treatment <span class="op">=</span> <span class="st">"exclosure"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">merged_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">rodent_abundance_merged</span>, </span>
<span>                      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">censusdate</span>, y <span class="op">=</span> <span class="va">abundance</span>, color <span class="op">=</span> <span class="va">treatment</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">scientific_name</span>, scales <span class="op">=</span> <span class="st">"free_y"</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Abundance"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span>breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"1977-01-01"</span><span class="op">)</span>, to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2018-01-01"</span><span class="op">)</span>, <span class="st">"+5 years"</span><span class="op">)</span>, </span>
<span>               date_labels <span class="op">=</span> <span class="st">"%Y"</span>, </span>
<span>               limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"1977-01-01"</span>, <span class="st">"2018-01-01"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_color_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"purple"</span>, <span class="st">"yellow"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://wilkelab.org/cowplot/reference/theme_cowplot.html" class="external-link">theme_cowplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">90</span>, hjust <span class="op">=</span> <span class="fl">1</span>, vjust <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>, </span>
<span>        legend.position <span class="op">=</span> <span class="st">"bottom"</span>, legend.justification <span class="op">=</span> <span class="st">"center"</span>, </span>
<span>        strip.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">merged_plot</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="rodent-abundance-demo_files/figure-html/unnamed-chunk-17-1.png" alt="Monthly abundance of rodents (control vs. exclosure plots)" width="720"><p class="caption">
Monthly abundance of rodents (control vs. exclosure plots)
</p>
</div>
<p>As expected, there are substantially lower counts of kangaroo rats
(<em>Dipodomys spp.</em>) in the “exclosure” plots. We also observe very
similar abundances for some species, but increases in others
(e.g. “Chaetodipus baileyi”, “Perognathus flavus”, “Reithrodontomys
megalotis”)</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Glenda M. Yenni, Hao Ye, Erica M. Christensen, Juniper L. Simonis, Ellen K. Bledsoe, Renata M. Diaz, Shawn D. Taylor, Ethan P, White, S.K. Morgan Ernest.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
